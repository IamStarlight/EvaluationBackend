<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http#{//mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.evaluation.mapper.SubmitMapper">

    <select id="getSubmitList" resultType="java.util.Map">
        select id,name,details,url,submit_time,is_late,teacher_grade,total_grade
        from stu_homework,student
        where stu_homework.sid=student.id
        and wid=#{wid}
        and cid=#{cid}
    </select>

    <update id="teacherEvaluation">
        update stu_homework
        set teacher_grade=#{teacherGrade},teacher_comments=#{teacherComments},total_grade=teacher_grade+peer_grade,is_read=1
        where sid=#{sid}
        and wid=#{wid}
        and cid=#{cid}
    </update>

    <select id="getMySubmit" resultType="java.util.Map">
        select id,name,details,url,submit_time,submit_status,teacher_grade,total_grade
        from stu_homework,student
        where stu_homework.sid=student.id
        and wid=#{wid}
        and cid=#{cid}
        and sid=#{sid}
    </select>

    <select id="getStuWorkTodoInfo" resultType="java.util.Map">
        select homework.wid,cname,homework.title,homework.details,homework.url,end_time
        from stu_homework,homework,course
        where stu_homework.sid=#{id}
        and submit_status=1
        and stu_homework.wid=homework.wid
        and stu_homework.cid=homework.cid
        and stu_homework.cid=course.cid
    </select>

    <update id="studentAppealing">
        update stu_homework
        set is_appeal=1,appeal_reason=#{reason}
        where sid=#{sid}
        and wid=#{wid}
        and cid=#{wid}
    </update>

    <select id="getHomeworkToRead" resultType="java.util.Map">
        select sid,wid,cname,details,url,submit_time
        from stu_homework,course
        where course.tid=#{tid}
        and course.cid=#{cid}
        and stu_homework.cid=course.cid
        and stu_homework.is_read=0
    </select>
</mapper>