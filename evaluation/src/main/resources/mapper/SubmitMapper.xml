<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http#{//mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.evaluation.mapper.SubmitMapper">

    <select id="getSubmitList" resultType="java.util.Map">
        select id,name,details,url,submit_time,teacher_grade,total_grade
        from stu_homework,student
        where wid=#{wid}
        and cid=#{cid}
        and stu_homework.sid=student.id
    </select>

    <update id="teacherEvaluation">
        update stu_homework
        set teacher_grade=#{teacherGrade},teacher_comments=#{teacherComments},total_grade=teacher_grade+peer_grade,is_read=1
        where sid=#{sid}
        and wid=#{wid}
        and cid=#{cid}
    </update>

    <select id="getMySubmit" resultType="java.util.Map">
        select id,name,details,url,submit_time,teacher_grade,total_grade
        from stu_homework,student
        where stu_homework.sid=student.id
        and wid=#{wid}
        and cid=#{cid}
        and sid=#{sid}
    </select>

    <select id="getStuWorkTodoInfo" resultType="java.util.Map">
        select homework.wid,cname,homework.title,homework.details,homework.url,end_time
        from homework,sc,course
        where homework.cid=sc.cid
        and sc.sid=21301000
        and not exists
        (select * from stu_homework
        where wid=1
        and cid=1
        and stu_homework.cid=homework.cid
        and stu_homework.wid=homework.wid)
        and homework.cid=course.cid
    </select>

    <update id="studentAppealing">
        update stu_homework
        set is_appeal=1,appeal_reason=#{reason},appeal_time=#{appealTime}
        where sid=#{sid}
        and wid=#{wid}
        and cid=#{wid}
    </update>

    <select id="getHomeworkToRead" resultType="java.util.Map">
        select sid,wid,cname,details,url,submit_time
        from stu_homework,course
        where course.tid=#{tid}
        and course.cid=#{cid}
        and stu_homework.is_read=0
        and stu_homework.cid=course.cid
    </select>

    <select id="checkAppealing" resultType="java.util.Map">
        select id as sid,stu_homework.wid,name as sname,title,appeal_reason,appeal_time
        from student,stu_homework,homework
        where stu_homework.cid=#{cid}
        and is_appeal=1
        and stu_homework.cid=homework.cid
        and stu_homework.wid=homework.wid
        and stu_homework.sid=student.id
    </select>

    <select id="checkOneAppealing" resultType="java.util.Map">
        select title,stu_homework.details,stu_homework.url,total_grade,teacher_grade,peer_grade,appeal_reason,appeal_time
        from stu_homework,homework
        where stu_homework.cid=#{cid}
        and stu_homework.wid=#{wid}
        and stu_homework.sid=#{sid}
        and stu_homework.cid=homework.cid
        and stu_homework.wid=homework.wid
    </select>

    <select id="getSubmitListAll" resultType="java.util.Map">
        select id,name,details,url,submit_time,teacher_grade,total_grade
        from stu_homework,student
        where wid=#{wid}
        and cid=#{cid}
        and stu_homework.sid=student.id
    </select>

    <select id="getNotSubmitList" resultType="java.util.Map">
        select sc.sid,name as sname
        from sc,student
        where sc.sid not in
            (select sid
            from stu_homework
            where wid=#{wid}
            and cid=#{cid}
            and stu_homework.cid=sc.cid)
        and sc.sid=student.id
    </select>
</mapper>