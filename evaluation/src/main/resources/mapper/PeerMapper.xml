<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http#{//mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.evaluation.mapper.PeerMapper">

    <update id="peerEvaluation">
        update peer_evaluation
        set grade=#{grade},comments=#{comments}
        where eva_sid=#{evaSid}
        and be_eva_sid=#{sid}
        and wid=#{wid}
        and cid=#{cid}
    </update>

    <select id="getEvaluatingStudentVision" resultType="java.util.Map">
        select id as sid,name as sname,details,url,grade as eva_grade,comments as eva_comments
        from peer_evaluation,student,stu_homework
        where peer_evaluation.eva_sid=student.id
        and peer_evaluation.wid=stu_homework.wid
        and peer_evaluation.cid=stu_homework.cid
        and eva_sid=#{id}
    </select>

    <select id="getBeEvaluatedStudentVision" resultType="java.util.Map">
        select id as sid,name as sname,details,url,grade as eva_grade,comments as eva_comments
        from peer_evaluation,student,stu_homework
        where peer_evaluation.eva_sid=student.id
        and peer_evaluation.wid=stu_homework.wid
        and peer_evaluation.cid=stu_homework.cid
        and be_eva_sid=#{id}
    </select>

    <update id="teaEvaluation">
        update stu_homework
        set teacherGrade=#{teacherGrade},teacherComments=#{teacherComments}
        where sid=#{sid}
        and wid=#{wid}
        and cid=#{cid}
    </update>

    <insert id="addEvaluation">
        insert into peer_evaluation
        values (#{evaSid},#{sid},#{wid},#{cid},#{grade},#{comments})
    </insert>

    <select id="selectAllWork">
        select * from stu_homework
        where sid in(
        select sid from peer_evaluation
        where evaSId=#{evaSid}
        and cid=#{cid})
    </select>

    <select id="selectTeaAllWork">
        select * from stu_homework
        where wid=#{wid}
    </select>

    <select id="selectForTeacher">
        select * from peer_evaluation
        where evaSid=#{evaSid}
        and wid=#{wid}
    </select>

    <select id="selectForStudent">
        select * from peer_evaluation
        where sid=#{sid}
        and cid=#{cid}
        and wid=#{wid}
    </select>

    <select id="selectOneWork">
        select * from stu_homework
        where sid=#{sid}
        and cid=#{cid}
        and wid=#{wid}
    </select>

    <select id="selectOneWorkForTea">
        select * from stu_homework
        where sid=#{sid}
        and cid=#{cid}
        and wid=#{wid}
    </select>
</mapper>
